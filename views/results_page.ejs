<!DOCTYPE html>
<html>
<head>
    <title>Election Result - <%= election.title %></title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="login-container" style="width: 800px;">
        <div style="display: flex; justify-content: space-between;">
            <h2><%= election.title %> - Currect Result</h2>
            <a href="/dashboard"><button style="width: auto; background-color: #666;">Back</button></a>
        </div>
        <hr>

        <div style="display: flex; justify-content: space-around; flex-wrap: wrap;">
            <div style="width: 350px;">
                <canvas id="pieChart"></canvas>
            </div>
            
            <div style="width: 350px;">
                <canvas id="barChart"></canvas>
            </div>
        </div>

        <div style="margin-top: 30px;">
            <h3>Detail Statistic</h3>
            <table border="1" cellpadding="10" cellspacing="0" style="width: 100%; border-collapse: collapse;">
                <tr style="background-color: #f0f0f0;">
                    <th>Candidate/option</th>
                    <th>Votes received</th>
                    <th>Vote percentage</th>
                </tr>
                <% 
                   const totalVotes = election.candidates.reduce((acc, c) => acc + c.voteCount, 0); 
                %>
                <% election.candidates.forEach(function(candidate) { %>
                    <tr>
                        <td><%= candidate.name %></td>
                        <td><%= candidate.voteCount %> vote</td>
                        <td>
                            <%= totalVotes > 0 ? ((candidate.voteCount / totalVotes) * 100).toFixed(1) : 0 %>%
                        </td>
                    </tr>
                <% }); %>
            </table>
        </div>
    </div>

    <script>
        const candidates = <%- JSON.stringify(election.candidates) %>;
        
        const labels = candidates.map(c => c.name);
        const data = candidates.map(c => c.voteCount);

        const backgroundColors = [
            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
        ];

        const ctxPie = document.getElementById('pieChart').getContext('2d');
        new Chart(ctxPie, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: backgroundColors
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: 'Vote Share Distribution' }
                }
            }
        });

        const ctxBar = document.getElementById('barChart').getContext('2d');
        new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Vote received',
                    data: data,
                    backgroundColor: backgroundColors,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true, ticks: { stepSize: 1 } }
                },
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'Vote Count' }
                }
            }
        });
    </script>
</body>
</html>